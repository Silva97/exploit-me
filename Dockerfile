FROM gcc:12.1.0 AS builder
ARG EXPLOITME_NAME
ARG FLAG

WORKDIR /app/${EXPLOITME_NAME}

COPY common /app/common
COPY ${EXPLOITME_NAME} /app/${EXPLOITME_NAME}
RUN OUTBIN=/app/challenge \
    EME_CHALLENGE_FLAG=${FLAG} \
    make static


FROM alpine:3.17.2
EXPOSE 1337
WORKDIR /app

COPY --from=builder /app/challenge ./challenge

CMD ["./challenge"]
