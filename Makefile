DOCKER_IMAGE_OWNER = silva97

.PHONY: all

all:
	@echo "Please, specify the exploitme number!"
	@echo "For instance, run 'make 001' to compile the 'exploitme001'."
	@exit 1

%: exploitme%
	cd "$<" && $(MAKE)

get-%: exploitme%
	docker run --rm --entrypoint cat "$(DOCKER_IMAGE_OWNER)/$<:latest" /app/challenge > "./challenge"
	chmod +x challenge

docker-%: exploitme%
	docker build \
		-t "$(DOCKER_IMAGE_OWNER)/$<:latest" \
		--build-arg "EXPLOITME_NAME=$<" \
		--build-arg "FLAG=$(FLAG)" \
		.

run-%: exploitme%
	docker run --rm -d --name "$<" "$(DOCKER_IMAGE_OWNER)/$<"
	@echo
	@docker inspect -f 'IP address: {{ .NetworkSettings.IPAddress }}' "$<"

stop-%: exploitme%
	docker kill "$<"

exploitme%:
	@echo "The $@ doesn't exists!"
	@exit 1
