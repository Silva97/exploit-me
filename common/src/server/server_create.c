#include <string.h>
#include "server.h"

#define MAX_QUEUE_LENGTH 100

int server_create(connection_t *server, in_port_t port)
{
  int result;

  server->address.sin_family = AF_INET;
  server->address.sin_addr.s_addr = htonl(INADDR_ANY);
  server->address.sin_port = htons(port);
  memset(&server->address.sin_zero, '\0', sizeof(server->address.sin_zero));

  server->socket = socket(AF_INET, SOCK_STREAM, 0);
  if (server->socket == -1)
  {
    return -1;
  }

  result = bind(server->socket, (struct sockaddr *)&server->address, sizeof server->address);
  if (result == -1)
  {
    return -1;
  }

  return listen(server->socket, MAX_QUEUE_LENGTH);
}
